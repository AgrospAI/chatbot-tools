{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "local-chatbot",
  "title": "Local Chatbot",
  "description": "A button bottom-right chatbot component that can be integrated into web applications.",
  "dependencies": [
    "dexie",
    "dexie-react-hooks"
  ],
  "registryDependencies": [
    "https://agrospai.github.io/chatbot-tools/r/chatbot.json"
  ],
  "files": [
    {
      "path": "src/registry/new-york/chatbot/components/chatbot/local-chatbot.tsx",
      "content": "import { useEffect, useState } from \"react\"\n\nimport type {\n  ChatbotProps,\n  Message,\n} from \"@/registry/new-york/chatbot/components/chatbot/chatbot\"\nimport Chatbot from \"@/registry/new-york/chatbot/components/chatbot/chatbot\"\nimport { db, settings } from \"@/registry/new-york/chatbot/lib/chatbot/db\"\nimport { useLiveQuery } from \"dexie-react-hooks\"\n\ntype Props = Omit<ChatbotProps, \"messages\" | \"setMessages\" | \"newChat\">\n\nexport default function LocalChatbot({\n  endpoint = \"http://localhost:8000/ask\",\n  strings,\n  icon,\n}: Props) {\n  const [currentChatId, setCurrentChatId] = useState<string | null>(null)\n\n  useEffect(() => {\n    ;(async () => {\n      let storedChatId = await settings.get(\"currentChatId\")\n\n      if (!storedChatId) {\n        storedChatId = crypto.randomUUID()\n        await db.chats.add({ id: storedChatId, messages: [] })\n        await settings.set(\"currentChatId\", storedChatId)\n      }\n\n      setCurrentChatId(storedChatId)\n      console.log(\"Current Chat ID:\", storedChatId)\n    })()\n  }, [])\n\n  const messages =\n    useLiveQuery(async () => {\n      if (!currentChatId) return []\n      const chat = await db.chats.get(currentChatId)\n      return chat?.messages ?? []\n    }, [currentChatId]) ?? []\n\n  const setMessages: React.Dispatch<\n    React.SetStateAction<Message[]>\n  > = value => {\n    if (!currentChatId) return\n    ;(async () => {\n      const chat = await db.chats.get(currentChatId)\n      const prev = chat?.messages ?? []\n\n      const next = typeof value === \"function\" ? value(prev) : value\n\n      await db.chats.update(currentChatId, { messages: next })\n    })()\n  }\n\n  const newChat = async () => {\n    await db.chats.clear()\n\n    const newChatId = crypto.randomUUID()\n    await db.chats.add({ id: newChatId, messages: [] })\n    await settings.set(\"currentChatId\", newChatId)\n    setCurrentChatId(newChatId)\n  }\n  return (\n    <Chatbot\n      endpoint={endpoint}\n      strings={strings}\n      icon={icon}\n      messages={messages}\n      setMessages={setMessages}\n      newChat={newChat}\n    />\n  )\n}\n",
      "type": "registry:component"
    },
    {
      "path": "src/registry/new-york/chatbot/lib/chatbot/db.ts",
      "content": "import type { Message } from \"@/registry/new-york/chatbot/components/chatbot/chatbot\"\nimport { Dexie, type EntityTable } from \"dexie\"\n\ninterface Chat {\n  id: string\n  messages: Message[]\n}\n\ninterface Setting {\n  key: string\n  value: string | null\n}\n\ninterface ChatSettings {\n  currentChatId: string | null\n}\n\nexport const db = new Dexie(\"ChatsDatabase\") as Dexie & {\n  chats: EntityTable<Chat, \"id\">\n  settings: EntityTable<Setting, \"key\">\n}\n\ndb.version(1).stores({\n  chats: \"&id\",\n  settings: \"&key\",\n})\n\nexport const settings = {\n  async get<K extends keyof ChatSettings>(\n    key: K,\n  ): Promise<ChatSettings[K] | null> {\n    const row = await db.settings.get(key)\n    return row?.value ?? null\n  },\n\n  async set<K extends keyof ChatSettings>(\n    key: K,\n    value: ChatSettings[K],\n  ): Promise<void> {\n    await db.settings.put({ key, value })\n  },\n}\n",
      "type": "registry:lib"
    }
  ],
  "type": "registry:component"
}